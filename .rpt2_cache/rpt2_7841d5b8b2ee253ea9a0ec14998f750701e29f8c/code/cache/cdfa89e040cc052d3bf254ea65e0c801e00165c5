{
  "code": "import { LayaGL } from \"../../layagl/LayaGL\";\r\nimport { BufferState2D } from \"../BufferState2D\";\r\nimport { Config } from \"./../../../Config\";\r\nimport { IndexBuffer2D } from \"./IndexBuffer2D\";\r\nimport { VertexBuffer2D } from \"./VertexBuffer2D\";\r\nexport class Mesh2D {\r\n    constructor(stride, vballoc, iballoc) {\r\n        this._stride = 0;\r\n        this.vertNum = 0;\r\n        this.indexNum = 0;\r\n        this._applied = false;\r\n        this._quadNum = 0;\r\n        this.canReuse = false;\r\n        this._stride = stride;\r\n        this._vb = new VertexBuffer2D(stride, LayaGL.instance.DYNAMIC_DRAW);\r\n        if (vballoc) {\r\n            this._vb._resizeBuffer(vballoc, false);\r\n        }\r\n        else {\r\n            Config.webGL2D_MeshAllocMaxMem && this._vb._resizeBuffer(64 * 1024 * stride, false);\r\n        }\r\n        this._ib = new IndexBuffer2D();\r\n        if (iballoc) {\r\n            this._ib._resizeBuffer(iballoc, false);\r\n        }\r\n    }\r\n    cloneWithNewVB() {\r\n        var mesh = new Mesh2D(this._stride, 0, 0);\r\n        mesh._ib = this._ib;\r\n        mesh._quadNum = this._quadNum;\r\n        mesh._attribInfo = this._attribInfo;\r\n        return mesh;\r\n    }\r\n    cloneWithNewVBIB() {\r\n        var mesh = new Mesh2D(this._stride, 0, 0);\r\n        mesh._attribInfo = this._attribInfo;\r\n        return mesh;\r\n    }\r\n    getVBW() {\r\n        this._vb.setNeedUpload();\r\n        return this._vb;\r\n    }\r\n    getVBR() {\r\n        return this._vb;\r\n    }\r\n    getIBR() {\r\n        return this._ib;\r\n    }\r\n    getIBW() {\r\n        this._ib.setNeedUpload();\r\n        return this._ib;\r\n    }\r\n    createQuadIB(QuadNum) {\r\n        this._quadNum = QuadNum;\r\n        this._ib._resizeBuffer(QuadNum * 6 * 2, false);\r\n        this._ib.byteLength = this._ib.bufferLength;\r\n        var bd = this._ib.getUint16Array();\r\n        var idx = 0;\r\n        var curvert = 0;\r\n        for (var i = 0; i < QuadNum; i++) {\r\n            bd[idx++] = curvert;\r\n            bd[idx++] = curvert + 2;\r\n            bd[idx++] = curvert + 1;\r\n            bd[idx++] = curvert;\r\n            bd[idx++] = curvert + 3;\r\n            bd[idx++] = curvert + 2;\r\n            curvert += 4;\r\n        }\r\n        this._ib.setNeedUpload();\r\n    }\r\n    setAttributes(attribs) {\r\n        this._attribInfo = attribs;\r\n        if (this._attribInfo.length % 3 != 0) {\r\n            throw 'Mesh2D setAttributes error!';\r\n        }\r\n    }\r\n    configVAO(gl) {\r\n        if (this._applied)\r\n            return;\r\n        this._applied = true;\r\n        if (!this._vao) {\r\n            this._vao = new BufferState2D();\r\n        }\r\n        this._vao.bind();\r\n        this._vb._bindForVAO();\r\n        this._ib.setNeedUpload();\r\n        this._ib._bind_uploadForVAO();\r\n        var attribNum = this._attribInfo.length / 3;\r\n        var idx = 0;\r\n        for (var i = 0; i < attribNum; i++) {\r\n            var _size = this._attribInfo[idx + 1];\r\n            var _type = this._attribInfo[idx];\r\n            var _off = this._attribInfo[idx + 2];\r\n            gl.enableVertexAttribArray(i);\r\n            gl.vertexAttribPointer(i, _size, _type, false, this._stride, _off);\r\n            idx += 3;\r\n        }\r\n        this._vao.unBind();\r\n    }\r\n    useMesh(gl) {\r\n        this._applied || this.configVAO(gl);\r\n        this._vao.bind();\r\n        this._vb.bind();\r\n        this._ib._bind_upload() || this._ib.bind();\r\n        this._vb._bind_upload() || this._vb.bind();\r\n    }\r\n    getEleNum() {\r\n        return this._ib.getBuffer().byteLength / 2;\r\n    }\r\n    releaseMesh() { }\r\n    destroy() {\r\n    }\r\n    clearVB() {\r\n        this._vb.clear();\r\n    }\r\n}\r\nMesh2D._gvaoid = 0;\r\n//# sourceMappingURL=Mesh2D.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/layagl/LayaGL.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/BufferState2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/Config.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/utils/IndexBuffer2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/utils/VertexBuffer2D.ts"
  ],
  "map": "{\"version\":3,\"file\":\"Mesh2D.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../libs/laya/webgl/utils/Mesh2D.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/webgl/utils/Mesh2D.d.ts",
    "writeByteOrderMark": false,
    "text": "import { IndexBuffer2D } from \"./IndexBuffer2D\";\r\nimport { VertexBuffer2D } from \"./VertexBuffer2D\";\r\nexport declare class Mesh2D {\r\n    _stride: number;\r\n    vertNum: number;\r\n    indexNum: number;\r\n    protected _applied: boolean;\r\n    _vb: VertexBuffer2D;\r\n    _ib: IndexBuffer2D;\r\n    private _vao;\r\n    private static _gvaoid;\r\n    private _attribInfo;\r\n    protected _quadNum: number;\r\n    canReuse: boolean;\r\n    constructor(stride: number, vballoc: number, iballoc: number);\r\n    cloneWithNewVB(): Mesh2D;\r\n    cloneWithNewVBIB(): Mesh2D;\r\n    getVBW(): VertexBuffer2D;\r\n    getVBR(): VertexBuffer2D;\r\n    getIBR(): IndexBuffer2D;\r\n    getIBW(): IndexBuffer2D;\r\n    createQuadIB(QuadNum: number): void;\r\n    setAttributes(attribs: any[]): void;\r\n    private configVAO;\r\n    useMesh(gl: WebGLRenderingContext): void;\r\n    getEleNum(): number;\r\n    releaseMesh(): void;\r\n    destroy(): void;\r\n    clearVB(): void;\r\n}\r\n"
  }
}
