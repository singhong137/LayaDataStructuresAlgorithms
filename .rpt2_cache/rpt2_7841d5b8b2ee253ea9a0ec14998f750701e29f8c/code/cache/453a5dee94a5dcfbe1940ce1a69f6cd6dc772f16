{
  "code": "import { Loader } from \"./Loader\";\r\nimport { URL } from \"./URL\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { Texture2D } from \"../resource/Texture2D\";\r\nexport class WorkerLoader extends EventDispatcher {\r\n    constructor() {\r\n        super();\r\n        this.worker = new Worker(WorkerLoader.workerPath);\r\n        let me = this;\r\n        this.worker.onmessage = function (evt) {\r\n            me.workerMessage(evt.data);\r\n        };\r\n    }\r\n    static __init__() {\r\n        if (WorkerLoader._preLoadFun != null)\r\n            return false;\r\n        if (!Worker)\r\n            return false;\r\n        WorkerLoader._preLoadFun = Loader[\"prototype\"][\"_loadImage\"];\r\n        Loader[\"prototype\"][\"_loadImage\"] = WorkerLoader[\"prototype\"][\"_loadImage\"];\r\n        if (!WorkerLoader.I)\r\n            WorkerLoader.I = new WorkerLoader();\r\n        return true;\r\n    }\r\n    static workerSupported() {\r\n        return Worker ? true : false;\r\n    }\r\n    static enableWorkerLoader() {\r\n        if (!WorkerLoader._tryEnabled) {\r\n            WorkerLoader.enable = true;\r\n            WorkerLoader._tryEnabled = true;\r\n        }\r\n    }\r\n    static set enable(value) {\r\n        if (WorkerLoader._enable != value) {\r\n            WorkerLoader._enable = value;\r\n            if (value && WorkerLoader._preLoadFun == null)\r\n                WorkerLoader._enable = WorkerLoader.__init__();\r\n        }\r\n    }\r\n    static get enable() {\r\n        return WorkerLoader._enable;\r\n    }\r\n    workerMessage(data) {\r\n        if (data) {\r\n            switch (data.type) {\r\n                case \"Image\":\r\n                    this.imageLoaded(data);\r\n                    break;\r\n                case \"Disable\":\r\n                    WorkerLoader.enable = false;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    imageLoaded(data) {\r\n        if (!data.dataType || data.dataType != \"imageBitmap\") {\r\n            this.event(data.url, null);\r\n            return;\r\n        }\r\n        var imageData = data.imageBitmap;\r\n        console.log(\"load:\", data.url);\r\n        this.event(data.url, imageData);\r\n    }\r\n    loadImage(url) {\r\n        this.worker.postMessage(url);\r\n    }\r\n    _loadImage(url) {\r\n        var _this = this;\r\n        let type = _this.type;\r\n        if (!this._useWorkerLoader || !WorkerLoader._enable) {\r\n            WorkerLoader._preLoadFun.call(_this, url);\r\n            return;\r\n        }\r\n        url = URL.formatURL(url);\r\n        function clear() {\r\n            WorkerLoader.I.off(url, _this, onload);\r\n        }\r\n        var onload = function (imageData) {\r\n            clear();\r\n            if (imageData) {\r\n                var image = imageData;\r\n                if (type !== \"nativeimage\") {\r\n                    image = new Texture2D();\r\n                    image.loadImageSource(imageData);\r\n                }\r\n                _this[\"onLoaded\"](image);\r\n            }\r\n            else {\r\n                WorkerLoader._preLoadFun.call(_this, url);\r\n            }\r\n        };\r\n        WorkerLoader.I.on(url, _this, onload);\r\n        WorkerLoader.I.loadImage(url);\r\n    }\r\n}\r\nWorkerLoader.workerPath = \"libs/workerloader.js\";\r\nWorkerLoader._enable = false;\r\nWorkerLoader._tryEnabled = false;\r\n//# sourceMappingURL=WorkerLoader.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/Loader.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/URL.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/events/EventDispatcher.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Texture2D.ts"
  ],
  "map": "{\"version\":3,\"file\":\"WorkerLoader.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../libs/laya/net/WorkerLoader.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/net/WorkerLoader.d.ts",
    "writeByteOrderMark": false,
    "text": "import { EventDispatcher } from \"../events/EventDispatcher\";\r\nexport declare class WorkerLoader extends EventDispatcher {\r\n    static I: WorkerLoader;\r\n    static workerPath: string;\r\n    private static _preLoadFun;\r\n    private static _enable;\r\n    private static _tryEnabled;\r\n    worker: Worker;\r\n    protected _useWorkerLoader: boolean;\r\n    constructor();\r\n    static __init__(): boolean;\r\n    static workerSupported(): boolean;\r\n    static enableWorkerLoader(): void;\r\n    static enable: boolean;\r\n    private workerMessage;\r\n    private imageLoaded;\r\n    loadImage(url: string): void;\r\n    protected _loadImage(url: string): void;\r\n}\r\n"
  }
}
