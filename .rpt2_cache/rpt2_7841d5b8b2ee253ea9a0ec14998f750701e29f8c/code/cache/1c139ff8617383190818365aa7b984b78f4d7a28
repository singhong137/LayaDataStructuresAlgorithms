{
  "code": "import { Matrix } from \"../../maths/Matrix\";\r\nimport { ShaderDefines2D } from \"../shader/d2/ShaderDefines2D\";\r\nimport { Value2D } from \"../shader/d2/value/Value2D\";\r\nimport { SubmitTexture } from \"../submit/SubmitTexture\";\r\nimport { RenderInfo } from \"../../renders/RenderInfo\";\r\nexport class CharSubmitCache {\r\n    constructor() {\r\n        this._data = [];\r\n        this._ndata = 0;\r\n        this._clipid = -1;\r\n        this._clipMatrix = new Matrix();\r\n        this._enable = false;\r\n    }\r\n    clear() {\r\n        this._tex = null;\r\n        this._imgId = -1;\r\n        this._ndata = 0;\r\n        this._enable = false;\r\n        this._colorFiler = null;\r\n    }\r\n    destroy() {\r\n        this.clear();\r\n        this._data.length = 0;\r\n        this._data = null;\r\n    }\r\n    add(ctx, tex, imgid, pos, uv, color) {\r\n        if (this._ndata > 0 && (this._tex != tex || this._imgId != imgid ||\r\n            (this._clipid >= 0 && this._clipid != ctx._clipInfoID))) {\r\n            this.submit(ctx);\r\n        }\r\n        this._clipid = ctx._clipInfoID;\r\n        ctx._globalClipMatrix.copyTo(this._clipMatrix);\r\n        this._tex = tex;\r\n        this._imgId = imgid;\r\n        this._colorFiler = ctx._colorFiler;\r\n        this._data[this._ndata] = pos;\r\n        this._data[this._ndata + 1] = uv;\r\n        this._data[this._ndata + 2] = color;\r\n        this._ndata += 3;\r\n    }\r\n    getPos() {\r\n        if (CharSubmitCache.__nPosPool == 0)\r\n            return new Array(8);\r\n        return CharSubmitCache.__posPool[--CharSubmitCache.__nPosPool];\r\n    }\r\n    enable(value, ctx) {\r\n        if (value === this._enable)\r\n            return;\r\n        this._enable = value;\r\n        this._enable || this.submit(ctx);\r\n    }\r\n    submit(ctx) {\r\n        var n = this._ndata;\r\n        if (!n)\r\n            return;\r\n        var _mesh = ctx._mesh;\r\n        var colorFiler = ctx._colorFiler;\r\n        ctx._colorFiler = this._colorFiler;\r\n        var submit = SubmitTexture.create(ctx, _mesh, Value2D.create(ShaderDefines2D.TEXTURE2D, 0));\r\n        ctx._submits[ctx._submits._length++] = ctx._curSubmit = submit;\r\n        submit.shaderValue.textureHost = this._tex;\r\n        submit._key.other = this._imgId;\r\n        ctx._colorFiler = colorFiler;\r\n        ctx._copyClipInfo(submit, this._clipMatrix);\r\n        submit.clipInfoID = this._clipid;\r\n        for (var i = 0; i < n; i += 3) {\r\n            _mesh.addQuad(this._data[i], this._data[i + 1], this._data[i + 2], true);\r\n            CharSubmitCache.__posPool[CharSubmitCache.__nPosPool++] = this._data[i];\r\n        }\r\n        n /= 3;\r\n        submit._numEle += n * 6;\r\n        _mesh.indexNum += n * 6;\r\n        _mesh.vertNum += n * 4;\r\n        ctx._drawCount += n;\r\n        this._ndata = 0;\r\n        if (RenderInfo.loopCount % 100 == 0)\r\n            this._data.length = 0;\r\n    }\r\n}\r\nCharSubmitCache.__posPool = [];\r\nCharSubmitCache.__nPosPool = 0;\r\n//# sourceMappingURL=CharSubmitCache.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/filters/ColorFilter.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/maths/Matrix.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Context.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Texture.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/d2/ShaderDefines2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/d2/value/Value2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/submit/SubmitTexture.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/utils/MeshQuadTexture.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/renders/RenderInfo.ts"
  ],
  "map": "{\"version\":3,\"file\":\"CharSubmitCache.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../libs/laya/webgl/text/CharSubmitCache.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/webgl/text/CharSubmitCache.d.ts",
    "writeByteOrderMark": false,
    "text": "import { ColorFilter } from \"../../filters/ColorFilter\";\r\nimport { Context } from \"../../resource/Context\";\r\nimport { Texture } from \"../../resource/Texture\";\r\nexport declare class CharSubmitCache {\r\n    private static __posPool;\r\n    private static __nPosPool;\r\n    private _data;\r\n    private _ndata;\r\n    private _tex;\r\n    private _imgId;\r\n    private _clipid;\r\n    private _clipMatrix;\r\n    _enable: boolean;\r\n    _colorFiler: ColorFilter;\r\n    constructor();\r\n    clear(): void;\r\n    destroy(): void;\r\n    add(ctx: Context, tex: Texture, imgid: number, pos: any[], uv: ArrayLike<number>, color: number): void;\r\n    getPos(): any[];\r\n    enable(value: boolean, ctx: Context): void;\r\n    submit(ctx: Context): void;\r\n}\r\n"
  }
}
