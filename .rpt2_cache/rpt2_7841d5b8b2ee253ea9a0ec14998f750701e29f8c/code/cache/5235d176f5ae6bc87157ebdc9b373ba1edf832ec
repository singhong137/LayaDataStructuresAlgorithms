{
  "code": "import { AudioSoundChannel } from \"./AudioSoundChannel\";\r\nimport { Event } from \"../../events/Event\";\r\nimport { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { URL } from \"../../net/URL\";\r\nimport { Render } from \"../../renders/Render\";\r\nimport { Browser } from \"../../utils/Browser\";\r\nimport { Pool } from \"../../utils/Pool\";\r\nimport { ILaya } from \"../../../ILaya\";\r\nexport class AudioSound extends EventDispatcher {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.loaded = false;\r\n    }\r\n    dispose() {\r\n        var ad = AudioSound._audioCache[this.url];\r\n        Pool.clearBySign(\"audio:\" + this.url);\r\n        if (ad) {\r\n            if (!Render.isConchApp) {\r\n                ad.src = \"\";\r\n            }\r\n            delete AudioSound._audioCache[this.url];\r\n        }\r\n    }\r\n    static _initMusicAudio() {\r\n        if (AudioSound._musicAudio)\r\n            return;\r\n        if (!AudioSound._musicAudio)\r\n            AudioSound._musicAudio = Browser.createElement(\"audio\");\r\n        if (!Render.isConchApp) {\r\n            Browser.document.addEventListener(\"mousedown\", AudioSound._makeMusicOK);\r\n        }\r\n    }\r\n    static _makeMusicOK() {\r\n        Browser.document.removeEventListener(\"mousedown\", AudioSound._makeMusicOK);\r\n        if (!AudioSound._musicAudio.src) {\r\n            AudioSound._musicAudio.src = \"\";\r\n            AudioSound._musicAudio.load();\r\n        }\r\n        else {\r\n            AudioSound._musicAudio.play();\r\n        }\r\n    }\r\n    load(url) {\r\n        url = URL.formatURL(url);\r\n        this.url = url;\r\n        var ad;\r\n        if (url == ILaya.SoundManager._bgMusic) {\r\n            AudioSound._initMusicAudio();\r\n            ad = AudioSound._musicAudio;\r\n            if (ad.src != url) {\r\n                AudioSound._audioCache[ad.src] = null;\r\n                ad = null;\r\n            }\r\n        }\r\n        else {\r\n            ad = AudioSound._audioCache[url];\r\n        }\r\n        if (ad && ad.readyState >= 2) {\r\n            this.event(Event.COMPLETE);\r\n            return;\r\n        }\r\n        if (!ad) {\r\n            if (url == ILaya.SoundManager._bgMusic) {\r\n                AudioSound._initMusicAudio();\r\n                ad = AudioSound._musicAudio;\r\n            }\r\n            else {\r\n                ad = Browser.createElement(\"audio\");\r\n            }\r\n            AudioSound._audioCache[url] = ad;\r\n            ad.src = url;\r\n        }\r\n        ad.addEventListener(\"canplaythrough\", onLoaded);\r\n        ad.addEventListener(\"error\", onErr);\r\n        var me = this;\r\n        function onLoaded() {\r\n            offs();\r\n            me.loaded = true;\r\n            me.event(Event.COMPLETE);\r\n        }\r\n        function onErr() {\r\n            ad.load = null;\r\n            offs();\r\n            me.event(Event.ERROR);\r\n        }\r\n        function offs() {\r\n            ad.removeEventListener(\"canplaythrough\", onLoaded);\r\n            ad.removeEventListener(\"error\", onErr);\r\n        }\r\n        this.audio = ad;\r\n        if (ad.load) {\r\n            ad.load();\r\n        }\r\n        else {\r\n            onErr();\r\n        }\r\n    }\r\n    play(startTime = 0, loops = 0) {\r\n        if (!this.url)\r\n            return null;\r\n        var ad;\r\n        if (this.url == ILaya.SoundManager._bgMusic) {\r\n            ad = AudioSound._musicAudio;\r\n        }\r\n        else {\r\n            ad = AudioSound._audioCache[this.url];\r\n        }\r\n        if (!ad)\r\n            return null;\r\n        var tAd;\r\n        tAd = Pool.getItem(\"audio:\" + this.url);\r\n        if (Render.isConchApp) {\r\n            if (!tAd) {\r\n                tAd = Browser.createElement(\"audio\");\r\n                tAd.src = this.url;\r\n            }\r\n        }\r\n        else {\r\n            if (this.url == ILaya.SoundManager._bgMusic) {\r\n                AudioSound._initMusicAudio();\r\n                tAd = AudioSound._musicAudio;\r\n                tAd.src = this.url;\r\n            }\r\n            else {\r\n                tAd = tAd ? tAd : ad.cloneNode(true);\r\n            }\r\n        }\r\n        var channel = new AudioSoundChannel(tAd);\r\n        channel.url = this.url;\r\n        channel.loops = loops;\r\n        channel.startTime = startTime;\r\n        channel.play();\r\n        ILaya.SoundManager.addChannel(channel);\r\n        return channel;\r\n    }\r\n    get duration() {\r\n        var ad;\r\n        ad = AudioSound._audioCache[this.url];\r\n        if (!ad)\r\n            return 0;\r\n        return ad.duration;\r\n    }\r\n}\r\nAudioSound._audioCache = {};\r\n//# sourceMappingURL=AudioSound.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/media/h5audio/AudioSoundChannel.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/events/Event.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/events/EventDispatcher.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/media/SoundChannel.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/URL.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/renders/Render.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Browser.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Pool.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/ILaya.ts"
  ],
  "map": "{\"version\":3,\"file\":\"AudioSound.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../libs/laya/media/h5audio/AudioSound.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/media/h5audio/AudioSound.d.ts",
    "writeByteOrderMark": false,
    "text": "import { EventDispatcher } from \"../../events/EventDispatcher\";\r\nimport { SoundChannel } from \"../SoundChannel\";\r\nexport declare class AudioSound extends EventDispatcher {\r\n    private static _audioCache;\r\n    url: string;\r\n    audio: HTMLAudioElement;\r\n    loaded: boolean;\r\n    static _musicAudio: HTMLAudioElement;\r\n    dispose(): void;\r\n    static _initMusicAudio(): void;\r\n    private static _makeMusicOK;\r\n    load(url: string): void;\r\n    play(startTime?: number, loops?: number): SoundChannel;\r\n    readonly duration: number;\r\n}\r\n"
  }
}
