{
  "code": "import { SubmitBase } from \"./SubmitBase\";\r\nimport { Stat } from \"../../utils/Stat\";\r\nimport { WebGLContext } from \"../WebGLContext\";\r\nimport { BlendMode } from \"../canvas/BlendMode\";\r\nimport { BaseShader } from \"../shader/BaseShader\";\r\nimport { ShaderDefines2D } from \"../shader/d2/ShaderDefines2D\";\r\nimport { CONST3D2D } from \"../utils/CONST3D2D\";\r\nexport class SubmitTexture extends SubmitBase {\r\n    constructor(renderType = SubmitBase.TYPE_2D) {\r\n        super(renderType);\r\n    }\r\n    releaseRender() {\r\n        if ((--this._ref) < 1) {\r\n            SubmitTexture.POOL[SubmitTexture._poolSize++] = this;\r\n            this.shaderValue.release();\r\n            this._mesh = null;\r\n            this._parent && (this._parent.releaseRender(), this._parent = null);\r\n        }\r\n    }\r\n    renderSubmit() {\r\n        if (this._numEle === 0)\r\n            return 1;\r\n        var tex = this.shaderValue.textureHost;\r\n        if (tex) {\r\n            var source = tex ? tex._getSource() : null;\r\n            if (!source)\r\n                return 1;\r\n        }\r\n        var gl = WebGLContext.mainContext;\r\n        this._mesh.useMesh(gl);\r\n        var lastSubmit = SubmitBase.preRender;\r\n        var prekey = SubmitBase.preRender._key;\r\n        if (this._key.blendShader === 0 && (this._key.submitType === prekey.submitType && this._key.blendShader === prekey.blendShader) && BaseShader.activeShader &&\r\n            SubmitBase.preRender.clipInfoID == this.clipInfoID &&\r\n            lastSubmit.shaderValue.defines._value === this.shaderValue.defines._value &&\r\n            (this.shaderValue.defines._value & ShaderDefines2D.NOOPTMASK) == 0) {\r\n            BaseShader.activeShader.uploadTexture2D(source);\r\n        }\r\n        else {\r\n            if (BlendMode.activeBlendFunction !== this._blendFn) {\r\n                WebGLContext.setBlend(gl, true);\r\n                this._blendFn(gl);\r\n                BlendMode.activeBlendFunction = this._blendFn;\r\n            }\r\n            this.shaderValue.texture = source;\r\n            this.shaderValue.upload();\r\n        }\r\n        gl.drawElements(gl.TRIANGLES, this._numEle, gl.UNSIGNED_SHORT, this._startIdx);\r\n        Stat.renderBatches++;\r\n        Stat.trianglesFaces += this._numEle / 3;\r\n        return 1;\r\n    }\r\n    static create(context, mesh, sv) {\r\n        var o = SubmitTexture._poolSize ? SubmitTexture.POOL[--SubmitTexture._poolSize] : new SubmitTexture(SubmitBase.TYPE_TEXTURE);\r\n        o._mesh = mesh;\r\n        o._key.clear();\r\n        o._key.submitType = SubmitBase.KEY_DRAWTEXTURE;\r\n        o._ref = 1;\r\n        o._startIdx = mesh.indexNum * CONST3D2D.BYTES_PIDX;\r\n        o._numEle = 0;\r\n        var blendType = context._nBlendType;\r\n        o._key.blendShader = blendType;\r\n        o._blendFn = context._targets ? BlendMode.targetFns[blendType] : BlendMode.fns[blendType];\r\n        o.shaderValue = sv;\r\n        if (context._colorFiler) {\r\n            var ft = context._colorFiler;\r\n            sv.defines.add(ft.type);\r\n            sv.colorMat = ft._mat;\r\n            sv.colorAlpha = ft._alpha;\r\n        }\r\n        return o;\r\n    }\r\n}\r\nSubmitTexture._poolSize = 0;\r\nSubmitTexture.POOL = [];\r\n//# sourceMappingURL=SubmitTexture.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/submit/SubmitBase.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/submit/SubmitKey.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/filters/ColorFilter.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Context.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Texture.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Stat.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/WebGLContext.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/canvas/BlendMode.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/BaseShader.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/Shader.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/d2/ShaderDefines2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/d2/value/TextureSV.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/shader/d2/value/Value2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/utils/CONST3D2D.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/webgl/utils/Mesh2D.ts"
  ],
  "map": "{\"version\":3,\"file\":\"SubmitTexture.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../libs/laya/webgl/submit/SubmitTexture.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAK1C,OAAO,EAAE,IAAI,EAAE,MAAM,kBAAkB,CAAA;AACvC,OAAO,EAAE,YAAY,EAAE,MAAM,iBAAiB,CAAA;AAC9C,OAAO,EAAE,SAAS,EAAE,MAAM,qBAAqB,CAAA;AAC/C,OAAO,EAAE,UAAU,EAAE,MAAM,sBAAsB,CAAA;AAEjD,OAAO,EAAE,eAAe,EAAE,MAAM,8BAA8B,CAAA;AAG9D,OAAO,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAA;AAG9C,MAAM,OAAO,aAAc,SAAQ,UAAU;IAGzC,YAAY,aAAqB,UAAU,CAAC,OAAO;QAC/C,KAAK,CAAC,UAAU,CAAC,CAAC;IACtB,CAAC;IAIW,aAAa;QACrB,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;YACnB,aAAa,CAAC,IAAI,CAAC,aAAa,CAAC,SAAS,EAAE,CAAC,GAAG,IAAI,CAAC;YACrD,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE,CAAC;YAE3B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;YAClB,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC;SACvE;IACL,CAAC;IAIW,YAAY;QACpB,IAAI,IAAI,CAAC,OAAO,KAAK,CAAC;YAClB,OAAO,CAAC,CAAC;QAEb,IAAI,GAAG,GAAY,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC;QAChD,IAAI,GAAG,EAAE;YACL,IAAI,MAAM,GAAQ,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;YAChD,IAAI,CAAC,MAAM;gBAAE,OAAO,CAAC,CAAC;SACzB;QAED,IAAI,EAAE,GAA0B,YAAY,CAAC,WAAW,CAAC;QAEzD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAEvB,IAAI,UAAU,GAAkC,UAAU,CAAC,SAAU,CAAC;QACtE,IAAI,MAAM,GAA4B,UAAU,CAAC,SAAW,CAAC,IAAI,CAAC;QAClE,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,KAAK,MAAM,CAAC,UAAU,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,MAAM,CAAC,WAAW,CAAC,IAAI,UAAU,CAAC,YAAY;YACxI,UAAU,CAAC,SAAW,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU;YAClE,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,KAAK,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM;YACzE,CAAC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,MAAM,GAAG,eAAe,CAAC,SAAS,CAAC,IAAI,CAAC,EACpE;YACY,UAAU,CAAC,YAAc,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;SAC/D;aACI;YACD,IAAI,SAAS,CAAC,mBAAmB,KAAK,IAAI,CAAC,QAAQ,EAAE;gBACjD,YAAY,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;gBAChC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;gBAClB,SAAS,CAAC,mBAAmB,GAAG,IAAI,CAAC,QAAQ,CAAC;aACjD;YACD,IAAI,CAAC,WAAW,CAAC,OAAO,GAAG,MAAM,CAAC;YAClC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;SAC7B;QAED,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QAE/E,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QAExC,OAAO,CAAC,CAAC;IACb,CAAC;IAKD,MAAM,CAAC,MAAM,CAAC,OAAgB,EAAE,IAAY,EAAE,EAAW;QACrD,IAAI,CAAC,GAAkB,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QAC5I,CAAC,CAAC,KAAK,GAAG,IAAI,CAAC;QACf,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QACf,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,eAAe,CAAC;QAC/C,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC;QACX,CAAC,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,GAAG,SAAS,CAAC,UAAU,CAAC;QACnD,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC;QACd,IAAI,SAAS,GAAW,OAAO,CAAC,WAAW,CAAC;QAC5C,CAAC,CAAC,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC/B,CAAC,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC1F,CAAC,CAAC,WAAW,GAAG,EAAE,CAAC;QAEnB,IAAI,OAAO,CAAC,WAAW,EAAE;YACrB,IAAI,EAAE,GAAgB,OAAO,CAAC,WAAW,CAAC;YAC1C,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;YACX,EAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,IAAI,CAAC;YACxB,EAAI,CAAC,UAAU,GAAG,EAAE,CAAC,MAAM,CAAC;SAC5C;QACD,OAAO,CAAC,CAAC;IACb,CAAC;;AApFc,uBAAS,GAAW,CAAC,CAAC;AACtB,kBAAI,GAAU,EAAE,CAAC\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/webgl/submit/SubmitTexture.d.ts",
    "writeByteOrderMark": false,
    "text": "import { SubmitBase } from \"./SubmitBase\";\r\nimport { Context } from \"../../resource/Context\";\r\nimport { Value2D } from \"../shader/d2/value/Value2D\";\r\nimport { Mesh2D } from \"../utils/Mesh2D\";\r\nexport declare class SubmitTexture extends SubmitBase {\r\n    private static _poolSize;\r\n    private static POOL;\r\n    constructor(renderType?: number);\r\n    releaseRender(): void;\r\n    renderSubmit(): number;\r\n    static create(context: Context, mesh: Mesh2D, sv: Value2D): SubmitTexture;\r\n}\r\n"
  }
}
