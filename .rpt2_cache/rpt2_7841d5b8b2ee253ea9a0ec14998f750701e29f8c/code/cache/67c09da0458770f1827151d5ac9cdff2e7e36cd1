{
  "code": "import { FrameAnimation } from \"./FrameAnimation\";\r\nimport { ClassUtils } from \"../utils/ClassUtils\";\r\nimport { Ease } from \"../utils/Ease\";\r\nexport class EffectAnimation extends FrameAnimation {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._initData = {};\r\n    }\r\n    set target(v) {\r\n        if (this._target)\r\n            this._target.off(EffectAnimation.EFFECT_BEGIN, this, this._onOtherBegin);\r\n        this._target = v;\r\n        if (this._target)\r\n            this._target.on(EffectAnimation.EFFECT_BEGIN, this, this._onOtherBegin);\r\n        this._addEvent();\r\n    }\r\n    get target() {\r\n        return this._target;\r\n    }\r\n    _onOtherBegin(effect) {\r\n        if (effect === this)\r\n            return;\r\n        this.stop();\r\n    }\r\n    set playEvent(event) {\r\n        this._playEvent = event;\r\n        if (!event)\r\n            return;\r\n        this._addEvent();\r\n    }\r\n    _addEvent() {\r\n        if (!this._target || !this._playEvent)\r\n            return;\r\n        this._setControlNode(this._target);\r\n        this._target.on(this._playEvent, this, this._onPlayAction);\r\n    }\r\n    _onPlayAction() {\r\n        this.play(0, false);\r\n    }\r\n    play(start = 0, loop = true, name = \"\") {\r\n        if (!this._target)\r\n            return;\r\n        this._target.event(EffectAnimation.EFFECT_BEGIN, [this]);\r\n        this._recordInitData();\r\n        super.play(start, loop, name);\r\n    }\r\n    _recordInitData() {\r\n        if (!this._aniKeys)\r\n            return;\r\n        var i, len;\r\n        len = this._aniKeys.length;\r\n        var key;\r\n        for (i = 0; i < len; i++) {\r\n            key = this._aniKeys[i];\r\n            this._initData[key] = this._target[key];\r\n        }\r\n    }\r\n    set effectClass(classStr) {\r\n        this._effectClass = ClassUtils.getClass(classStr);\r\n        if (this._effectClass) {\r\n            var uiData = this._effectClass[\"uiView\"];\r\n            if (uiData) {\r\n                var aniData = uiData[\"animations\"];\r\n                if (aniData && aniData[0]) {\r\n                    var data = aniData[0];\r\n                    this._setUp({}, data);\r\n                    if (data.nodes && data.nodes[0]) {\r\n                        this._aniKeys = data.nodes[0].keys;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    set effectData(uiData) {\r\n        if (uiData) {\r\n            var aniData = uiData[\"animations\"];\r\n            if (aniData && aniData[0]) {\r\n                var data = aniData[0];\r\n                this._setUp({}, data);\r\n                if (data.nodes && data.nodes[0]) {\r\n                    this._aniKeys = data.nodes[0].keys;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _displayToIndex(value) {\r\n        if (!this._animationData)\r\n            return;\r\n        if (value < 0)\r\n            value = 0;\r\n        if (value > this._count)\r\n            value = this._count;\r\n        var nodes = this._animationData.nodes, i, len = nodes.length;\r\n        len = len > 1 ? 1 : len;\r\n        for (i = 0; i < len; i++) {\r\n            this._displayNodeToFrame(nodes[i], value);\r\n        }\r\n    }\r\n    _displayNodeToFrame(node, frame, targetDic = null) {\r\n        if (!this._target)\r\n            return;\r\n        var target = this._target;\r\n        var frames = node.frames, key, propFrames, value;\r\n        var keys = node.keys, i, len = keys.length;\r\n        var secondFrames = node.secondFrames;\r\n        var tSecondFrame;\r\n        var easeFun;\r\n        var tKeyFrames;\r\n        var startFrame;\r\n        var endFrame;\r\n        for (i = 0; i < len; i++) {\r\n            key = keys[i];\r\n            propFrames = frames[key];\r\n            tSecondFrame = secondFrames[key];\r\n            if (tSecondFrame == -1) {\r\n                value = this._initData[key];\r\n            }\r\n            else {\r\n                if (frame < tSecondFrame) {\r\n                    tKeyFrames = node.keyframes[key];\r\n                    startFrame = tKeyFrames[0];\r\n                    if (startFrame.tween) {\r\n                        easeFun = Ease[startFrame.tweenMethod];\r\n                        if (easeFun == null)\r\n                            easeFun = Ease.linearNone;\r\n                        endFrame = tKeyFrames[1];\r\n                        value = easeFun(frame, this._initData[key], endFrame.value - this._initData[key], endFrame.index);\r\n                    }\r\n                    else {\r\n                        value = this._initData[key];\r\n                    }\r\n                }\r\n                else {\r\n                    if (propFrames.length > frame)\r\n                        value = propFrames[frame];\r\n                    else\r\n                        value = propFrames[propFrames.length - 1];\r\n                }\r\n            }\r\n            target[key] = value;\r\n        }\r\n    }\r\n    _calculateKeyFrames(node) {\r\n        super._calculateKeyFrames(node);\r\n        var keyFrames = node.keyframes, key, tKeyFrames, target = node.target;\r\n        var secondFrames = {};\r\n        node.secondFrames = secondFrames;\r\n        for (key in keyFrames) {\r\n            tKeyFrames = keyFrames[key];\r\n            if (tKeyFrames.length <= 1)\r\n                secondFrames[key] = -1;\r\n            else\r\n                secondFrames[key] = tKeyFrames[1].index;\r\n        }\r\n    }\r\n}\r\nEffectAnimation.EFFECT_BEGIN = \"effectbegin\";\r\nClassUtils.regClass(\"laya.display.EffectAnimation\", EffectAnimation);\r\nClassUtils.regClass(\"Laya.EffectAnimation\", EffectAnimation);\r\n//# sourceMappingURL=EffectAnimation.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/display/FrameAnimation.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/ClassUtils.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Ease.ts"
  ],
  "map": "{\"version\":3,\"file\":\"EffectAnimation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../libs/laya/display/EffectAnimation.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/display/EffectAnimation.d.ts",
    "writeByteOrderMark": false,
    "text": "import { FrameAnimation } from \"./FrameAnimation\";\r\nexport declare class EffectAnimation extends FrameAnimation {\r\n    private static EFFECT_BEGIN;\r\n    private _target;\r\n    private _playEvent;\r\n    private _initData;\r\n    private _aniKeys;\r\n    private _effectClass;\r\n    target: any;\r\n    private _onOtherBegin;\r\n    playEvent: string;\r\n    private _addEvent;\r\n    private _onPlayAction;\r\n    play(start?: any, loop?: boolean, name?: string): void;\r\n    private _recordInitData;\r\n    effectClass: string;\r\n    effectData: any;\r\n    protected _displayToIndex(value: number): void;\r\n    protected _displayNodeToFrame(node: any, frame: number, targetDic?: any): void;\r\n    protected _calculateKeyFrames(node: any): void;\r\n}\r\n"
  }
}
