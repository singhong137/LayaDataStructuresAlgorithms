{
  "code": "import { Loader } from \"./Loader\";\r\nimport { ILaya } from \"./../../ILaya\";\r\nimport { AtlasInfoManager } from \"./AtlasInfoManager\";\r\nimport { LoaderManager } from \"./LoaderManager\";\r\nimport { Prefab } from \"../components/Prefab\";\r\nimport { Event } from \"../events/Event\";\r\nimport { EventDispatcher } from \"../events/EventDispatcher\";\r\nimport { Handler } from \"../utils/Handler\";\r\nimport { Utils } from \"../utils/Utils\";\r\nexport class SceneLoader extends EventDispatcher {\r\n    constructor() {\r\n        super();\r\n        this._completeHandler = new Handler(this, this.onOneLoadComplete);\r\n        this.reset();\r\n    }\r\n    reset() {\r\n        this._toLoadList = [];\r\n        this._isLoading = false;\r\n        this.totalCount = 0;\r\n    }\r\n    get leftCount() {\r\n        if (this._isLoading)\r\n            return this._toLoadList.length + 1;\r\n        return this._toLoadList.length;\r\n    }\r\n    get loadedCount() {\r\n        return this.totalCount - this.leftCount;\r\n    }\r\n    load(url, is3D = false, ifCheck = true) {\r\n        if (url instanceof Array) {\r\n            var i, len;\r\n            len = url.length;\r\n            for (i = 0; i < len; i++) {\r\n                this._addToLoadList(url[i], is3D);\r\n            }\r\n        }\r\n        else {\r\n            this._addToLoadList(url, is3D);\r\n        }\r\n        if (ifCheck)\r\n            this._checkNext();\r\n    }\r\n    _addToLoadList(url, is3D = false) {\r\n        if (this._toLoadList.indexOf(url) >= 0)\r\n            return;\r\n        if (Loader.getRes(url))\r\n            return;\r\n        if (is3D) {\r\n            this._toLoadList.push({ url: url });\r\n        }\r\n        else\r\n            this._toLoadList.push(url);\r\n        this.totalCount++;\r\n    }\r\n    _checkNext() {\r\n        if (!this._isLoading) {\r\n            if (this._toLoadList.length == 0) {\r\n                this.event(Event.COMPLETE);\r\n                return;\r\n            }\r\n            var tItem;\r\n            tItem = this._toLoadList.pop();\r\n            if (typeof (tItem) == 'string') {\r\n                this.loadOne(tItem);\r\n            }\r\n            else {\r\n                this.loadOne(tItem.url, true);\r\n            }\r\n        }\r\n    }\r\n    loadOne(url, is3D = false) {\r\n        this._curUrl = url;\r\n        var type = Utils.getFileExtension(this._curUrl);\r\n        if (is3D) {\r\n            ILaya.loader.create(url, this._completeHandler);\r\n        }\r\n        else if (SceneLoader.LoadableExtensions[type]) {\r\n            ILaya.loader.load(url, this._completeHandler, null, SceneLoader.LoadableExtensions[type]);\r\n        }\r\n        else if (url != AtlasInfoManager.getFileLoadPath(url) || SceneLoader.No3dLoadTypes[type] || !LoaderManager.createMap[type]) {\r\n            ILaya.loader.load(url, this._completeHandler);\r\n        }\r\n        else {\r\n            ILaya.loader.create(url, this._completeHandler);\r\n        }\r\n    }\r\n    onOneLoadComplete() {\r\n        this._isLoading = false;\r\n        if (!Loader.getRes(this._curUrl)) {\r\n            console.log(\"Fail to load:\", this._curUrl);\r\n        }\r\n        var type = Utils.getFileExtension(this._curUrl);\r\n        if (SceneLoader.LoadableExtensions[type]) {\r\n            var dataO;\r\n            dataO = Loader.getRes(this._curUrl);\r\n            if (dataO && (dataO instanceof Prefab)) {\r\n                dataO = dataO.json;\r\n            }\r\n            if (dataO) {\r\n                if (dataO.loadList) {\r\n                    this.load(dataO.loadList, false, false);\r\n                }\r\n                if (dataO.loadList3D) {\r\n                    this.load(dataO.loadList3D, true, false);\r\n                }\r\n            }\r\n        }\r\n        if (type == \"sk\") {\r\n            this.load(this._curUrl.replace(\".sk\", \".png\"), false, false);\r\n        }\r\n        this.event(Event.PROGRESS, this.getProgress());\r\n        this._checkNext();\r\n    }\r\n    getProgress() {\r\n        return this.loadedCount / this.totalCount;\r\n    }\r\n}\r\nSceneLoader.LoadableExtensions = { \"scene\": Loader.JSON, \"scene3d\": Loader.JSON, \"ani\": Loader.JSON, \"ui\": Loader.JSON, \"prefab\": Loader.PREFAB };\r\nSceneLoader.No3dLoadTypes = { \"png\": true, \"jpg\": true, \"txt\": true };\r\n//# sourceMappingURL=SceneLoader.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/Loader.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/ILaya.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/AtlasInfoManager.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/net/LoaderManager.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/components/Prefab.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/events/Event.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/events/EventDispatcher.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Handler.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Utils.ts"
  ],
  "map": "{\"version\":3,\"file\":\"SceneLoader.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../libs/laya/net/SceneLoader.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/net/SceneLoader.d.ts",
    "writeByteOrderMark": false,
    "text": "import { EventDispatcher } from \"../events/EventDispatcher\";\r\nexport declare class SceneLoader extends EventDispatcher {\r\n    static LoadableExtensions: any;\r\n    static No3dLoadTypes: any;\r\n    totalCount: number;\r\n    private _completeHandler;\r\n    private _toLoadList;\r\n    private _isLoading;\r\n    private _curUrl;\r\n    constructor();\r\n    reset(): void;\r\n    readonly leftCount: number;\r\n    readonly loadedCount: number;\r\n    load(url: any, is3D?: boolean, ifCheck?: boolean): void;\r\n    private _addToLoadList;\r\n    private _checkNext;\r\n    private loadOne;\r\n    private onOneLoadComplete;\r\n    getProgress(): number;\r\n}\r\n"
  }
}
