{
  "code": "import { Point } from \"../../maths/Point\";\r\nimport { Rectangle } from \"../../maths/Rectangle\";\r\nimport { HTMLCanvas } from \"../../resource/HTMLCanvas\";\r\nimport { Pool } from \"../../utils/Pool\";\r\nexport class CacheStyle {\r\n    constructor() {\r\n        this.reset();\r\n    }\r\n    needBitmapCache() {\r\n        return this.cacheForFilters || !!this.mask;\r\n    }\r\n    needEnableCanvasRender() {\r\n        return this.userSetCache != \"none\" || this.cacheForFilters || !!this.mask;\r\n    }\r\n    releaseContext() {\r\n        if (this.canvas && this.canvas.size) {\r\n            Pool.recover(\"CacheCanvas\", this.canvas);\r\n            this.canvas.size(0, 0);\r\n            try {\r\n                this.canvas.width = 0;\r\n                this.canvas.height = 0;\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.canvas = null;\r\n    }\r\n    createContext() {\r\n        if (!this.canvas) {\r\n            this.canvas = Pool.getItem(\"CacheCanvas\") || new HTMLCanvas(false);\r\n            var tx = this.canvas.context;\r\n            if (!tx) {\r\n                tx = this.canvas.getContext('2d');\r\n            }\r\n        }\r\n    }\r\n    releaseFilterCache() {\r\n        var fc = this.filterCache;\r\n        if (fc) {\r\n            fc.destroy();\r\n            fc.recycle();\r\n            this.filterCache = null;\r\n        }\r\n    }\r\n    recover() {\r\n        if (this === CacheStyle.EMPTY)\r\n            return;\r\n        Pool.recover(\"SpriteCache\", this.reset());\r\n    }\r\n    reset() {\r\n        this.releaseContext();\r\n        this.releaseFilterCache();\r\n        this.cacheAs = \"none\";\r\n        this.enableCanvasRender = false;\r\n        this.userSetCache = \"none\";\r\n        this.cacheForFilters = false;\r\n        this.staticCache = false;\r\n        this.reCache = true;\r\n        this.mask = null;\r\n        this.maskParent = null;\r\n        this.filterCache = null;\r\n        this.filters = null;\r\n        this.hasGlowFilter = false;\r\n        if (this.cacheRect)\r\n            this.cacheRect.recover();\r\n        this.cacheRect = null;\r\n        return this;\r\n    }\r\n    static create() {\r\n        return Pool.getItemByClass(\"SpriteCache\", CacheStyle);\r\n    }\r\n    _calculateCacheRect(sprite, tCacheType, x, y) {\r\n        var _cacheStyle = sprite._cacheStyle;\r\n        if (!_cacheStyle.cacheRect)\r\n            _cacheStyle.cacheRect = Rectangle.create();\r\n        var tRec;\r\n        if (tCacheType === \"bitmap\") {\r\n            tRec = sprite.getSelfBounds();\r\n            tRec.width = tRec.width + CacheStyle.CANVAS_EXTEND_EDGE * 2;\r\n            tRec.height = tRec.height + CacheStyle.CANVAS_EXTEND_EDGE * 2;\r\n            tRec.x = tRec.x - sprite.pivotX;\r\n            tRec.y = tRec.y - sprite.pivotY;\r\n            tRec.x = tRec.x - CacheStyle.CANVAS_EXTEND_EDGE;\r\n            tRec.y = tRec.y - CacheStyle.CANVAS_EXTEND_EDGE;\r\n            tRec.x = Math.floor(tRec.x + x) - x;\r\n            tRec.y = Math.floor(tRec.y + y) - y;\r\n            tRec.width = Math.floor(tRec.width);\r\n            tRec.height = Math.floor(tRec.height);\r\n            _cacheStyle.cacheRect.copyFrom(tRec);\r\n        }\r\n        else {\r\n            _cacheStyle.cacheRect.setTo(-sprite._style.pivotX, -sprite._style.pivotY, 1, 1);\r\n        }\r\n        tRec = _cacheStyle.cacheRect;\r\n        if (sprite._style.scrollRect) {\r\n            var scrollRect = sprite._style.scrollRect;\r\n            tRec.x -= scrollRect.x;\r\n            tRec.y -= scrollRect.y;\r\n        }\r\n        CacheStyle._scaleInfo.setTo(1, 1);\r\n        return CacheStyle._scaleInfo;\r\n    }\r\n}\r\nCacheStyle.EMPTY = new CacheStyle();\r\nCacheStyle._scaleInfo = new Point();\r\nCacheStyle.CANVAS_EXTEND_EDGE = 16;\r\n//# sourceMappingURL=CacheStyle.js.map",
  "references": [
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/display/Sprite.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/maths/Point.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/maths/Rectangle.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/Context.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/resource/HTMLCanvas.ts",
    "D:/widgets/LayaDataStructuresAlgorithms/libs/laya/utils/Pool.ts"
  ],
  "map": "{\"version\":3,\"file\":\"CacheStyle.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../libs/laya/display/css/CacheStyle.ts\"],\"names\":[],\"mappings\":\"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\"}",
  "dts": {
    "name": "D:/widgets/LayaDataStructuresAlgorithms/.rpt2_cache/placeholder/laya/display/css/CacheStyle.d.ts",
    "writeByteOrderMark": false,
    "text": "import { Sprite } from \"../Sprite\";\r\nimport { Point } from \"../../maths/Point\";\r\nimport { Rectangle } from \"../../maths/Rectangle\";\r\nimport { HTMLCanvas } from \"../../resource/HTMLCanvas\";\r\nexport declare class CacheStyle {\r\n    static EMPTY: CacheStyle;\r\n    cacheAs: string;\r\n    enableCanvasRender: boolean;\r\n    userSetCache: string;\r\n    cacheForFilters: boolean;\r\n    staticCache: boolean;\r\n    reCache: boolean;\r\n    mask: Sprite;\r\n    maskParent: Sprite;\r\n    filters: any[];\r\n    cacheRect: Rectangle;\r\n    canvas: HTMLCanvas;\r\n    filterCache: any;\r\n    hasGlowFilter: boolean;\r\n    constructor();\r\n    needBitmapCache(): boolean;\r\n    needEnableCanvasRender(): boolean;\r\n    releaseContext(): void;\r\n    createContext(): void;\r\n    releaseFilterCache(): void;\r\n    recover(): void;\r\n    reset(): CacheStyle;\r\n    static create(): CacheStyle;\r\n    private static _scaleInfo;\r\n    static CANVAS_EXTEND_EDGE: number;\r\n    _calculateCacheRect(sprite: Sprite, tCacheType: string, x: number, y: number): Point;\r\n}\r\n"
  }
}
